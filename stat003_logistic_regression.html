<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Statistical learning: logistic regression</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Statistical learning: logistic regression</h1>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li>Demonstrate the use of logistic regression for classification</li>
<li>Implement logistic regression using the <code>glm()</code> function</li>
<li>Identify methods for assessing classification model accuracy</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(modelr)
<span class="kw">library</span>(broom)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)

<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
</div>
<div id="classification-problems" class="section level1">
<h1>Classification problems</h1>
<p>The sinking of <a href="https://en.wikipedia.org/wiki/RMS_Titanic">RMS Titanic</a> provided the world with many things:</p>
<ul>
<li>A fundamental shock to the world as its faith in supposedly indestructible technology was shattered by a chunk of ice</li>
<li>Perhaps the best romantic ballad of all time <iframe width="560" height="315" src="https://www.youtube.com/embed/WNIPqafd4As" frameborder="0" allowfullscreen></iframe></li>
<li><p>A tragic love story</p>
<div class="figure">
<img src="http://i.giphy.com/KSeT85Vtym7m.gif" alt="Titanic (1997)" />
<p class="caption"><a href="https://en.wikipedia.org/wiki/Titanic_(1997_film)">Titanic (1997)</a></p>
</div></li>
</ul>
<p>Why did Jack have to die? Why couldn’t he have made it onto a lifeboat like Cal? We may never know the answer, but we can generalize the question a bit: why did some people survive the sinking of the Titanic while others did not?</p>
<p>In essence, we have a classification problem. The response is a binary variable, indicating whether a specific passenger survived. If we combine this with predictors that describe each passenger, we might be able to estimate a general model of survival.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>Kaggle is an online platform for predictive modeling and analytics. They run regular competitions where they provide the public with a question and data, and anyone can estimate a predictive model to answer the question. They’ve run a popular contest based on a <a href="https://www.kaggle.com/c/titanic/data">dataset of passengers from the Titanic</a>. The datasets have been conveniently stored in a package called <code>titanic</code>. Let’s load the package and convert the desired data frame to a tibble.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(titanic)
titanic &lt;-<span class="st"> </span>titanic_train %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>()

titanic %&gt;%
<span class="st">  </span><span class="kw">head</span>() %&gt;%
<span class="st">  </span>knitr::<span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">PassengerId</th>
<th align="right">Survived</th>
<th align="right">Pclass</th>
<th align="left">Name</th>
<th align="left">Sex</th>
<th align="right">Age</th>
<th align="right">SibSp</th>
<th align="right">Parch</th>
<th align="left">Ticket</th>
<th align="right">Fare</th>
<th align="left">Cabin</th>
<th align="left">Embarked</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">Braund, Mr. Owen Harris</td>
<td align="left">male</td>
<td align="right">22</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">A/5 21171</td>
<td align="right">7.2500</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Cumings, Mrs. John Bradley (Florence Briggs Thayer)</td>
<td align="left">female</td>
<td align="right">38</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">PC 17599</td>
<td align="right">71.2833</td>
<td align="left">C85</td>
<td align="left">C</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="left">Heikkinen, Miss. Laina</td>
<td align="left">female</td>
<td align="right">26</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">STON/O2. 3101282</td>
<td align="right">7.9250</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td align="left">female</td>
<td align="right">35</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">113803</td>
<td align="right">53.1000</td>
<td align="left">C123</td>
<td align="left">S</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">Allen, Mr. William Henry</td>
<td align="left">male</td>
<td align="right">35</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">373450</td>
<td align="right">8.0500</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">Moran, Mr. James</td>
<td align="left">male</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">330877</td>
<td align="right">8.4583</td>
<td align="left"></td>
<td align="left">Q</td>
</tr>
</tbody>
</table>
<p>The codebook contains the following information on the variables:</p>
<pre><code>VARIABLE DESCRIPTIONS:
Survived        Survival
                (0 = No; 1 = Yes)
Pclass          Passenger Class
                (1 = 1st; 2 = 2nd; 3 = 3rd)
Name            Name
Sex             Sex
Age             Age
SibSp           Number of Siblings/Spouses Aboard
Parch           Number of Parents/Children Aboard
Ticket          Ticket Number
Fare            Passenger Fare
Cabin           Cabin
Embarked        Port of Embarkation
                (C = Cherbourg; Q = Queenstown; S = Southampton)

SPECIAL NOTES:
Pclass is a proxy for socio-economic status (SES)
 1st ~ Upper; 2nd ~ Middle; 3rd ~ Lower

Age is in Years; Fractional if Age less than One (1)
 If the Age is Estimated, it is in the form xx.5

With respect to the family relation variables (i.e. sibsp and parch)
some relations were ignored.  The following are the definitions used
for sibsp and parch.

Sibling:  Brother, Sister, Stepbrother, or Stepsister of Passenger Aboard Titanic
Spouse:   Husband or Wife of Passenger Aboard Titanic (Mistresses and Fiances Ignored)
Parent:   Mother or Father of Passenger Aboard Titanic
Child:    Son, Daughter, Stepson, or Stepdaughter of Passenger Aboard Titanic

Other family relatives excluded from this study include cousins,
nephews/nieces, aunts/uncles, and in-laws.  Some children travelled
only with a nanny, therefore parch=0 for them.  As well, some
travelled with very close friends or neighbors in a village, however,
the definitions do not support such relations.</code></pre>
<p>So if this is our data, <code>Survived</code> is our <strong>response variable</strong>, and the remaining variables are <strong>predictors</strong>, how can we determine who survives and who dies?</p>
<div id="a-linear-regression-approach" class="section level2">
<h2>A linear regression approach</h2>
<p>Let’s concentrate first on the relationship between age and survival. Using the methods we previously learned, we could estimate a linear regression model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic, <span class="kw">aes</span>(Age, Survived)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/titanic_ols-1.png" width="672" /></p>
<p>Hmm. Not terrible, but you can immediately notice a couple of things. First, the only possible values for <code>Survival</code> are <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. Yet the linear regression model gives us predicted values such as <span class="math inline">\(.4\)</span> and <span class="math inline">\(.25\)</span>. How should we interpret those?</p>
<p>One possibility is that these values are <strong>predicted probabilities</strong>. That is, the estimated probability a passenger will survive given their age. So someone with a predicted probability of <span class="math inline">\(.4\)</span> has a 40% chance of surviving. Okay, but notice that because the line is linear and continuous, it extends infinitely in both directions of age.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic, <span class="kw">aes</span>(Age, Survived)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">fullrange =</span> <span class="ot">TRUE</span>) +
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">200</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/titanic_ols_old-1.png" width="672" /></p>
<p>What happens if a 200 year old person is on the Titanic? They would have a <span class="math inline">\(-.1\)</span> probability of surviving. <strong>But you cannot have a probability outside of the <span class="math inline">\([0,1]\)</span> interval!</strong> Admittedly this is a trivial example, but in other circumstances this can become a more realistic scenario.</p>
<p>Or what if we didn’t want to predict survival, but instead predict the port from which an individual departed (Cherbourg, Queenstown, or Southampton). We could try and code this as a numeric response variable:</p>
<table>
<thead>
<tr class="header">
<th>Numeric value</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Cherbourg</td>
</tr>
<tr class="even">
<td>2</td>
<td>Queenstown</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Southampton</td>
</tr>
</tbody>
</table>
<p>But why not instead code it:</p>
<table>
<thead>
<tr class="header">
<th>Numeric value</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Queenstown</td>
</tr>
<tr class="even">
<td>2</td>
<td>Cherbourg</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Southampton</td>
</tr>
</tbody>
</table>
<p>Or even:</p>
<table>
<thead>
<tr class="header">
<th>Numeric value</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Southampton</td>
</tr>
<tr class="even">
<td>2</td>
<td>Cherbourg</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Queenstown</td>
</tr>
</tbody>
</table>
<p><strong>There is no inherent ordering to this variable</strong>. Any claimed linear relationship between a predictor and port of embarkation is completely dependent on how we convert the classes to numeric values.</p>
</div>
</div>
<div id="logistic-regression" class="section level1">
<h1>Logistic regression</h1>
<p>Rather than modeling the response <span class="math inline">\(Y\)</span> directly, logistic regression instead models the <strong>probability</strong> that <span class="math inline">\(Y\)</span> belongs to a particular category. In our first Titanic example, the probability of survival can be written as:</p>
<p><span class="math display">\[P(\text{survival} = \text{Yes} | \text{age})\]</span></p>
<p>The values of <span class="math inline">\(P(\text{survival} = \text{Yes} | \text{age})\)</span> (or simply <span class="math inline">\(p(\text{survival})\)</span> will range between 0 and 1. Given that predicted probability, we could predict anyone with for whom <span class="math inline">\(p(\text{survival}) &gt; .5\)</span> will survive the sinking, and anyone else will die.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<p>We can estimate the logistic regression model using the <code>glm</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">survive_age &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~<span class="st"> </span>Age, <span class="dt">data =</span> titanic, <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(survive_age)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Survived ~ Age, family = binomial, data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.1488  -1.0361  -0.9544   1.3159   1.5908  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept) -0.05672    0.17358  -0.327   0.7438  
## Age         -0.01096    0.00533  -2.057   0.0397 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 964.52  on 713  degrees of freedom
## Residual deviance: 960.23  on 712  degrees of freedom
##   (177 observations deleted due to missingness)
## AIC: 964.23
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Which produces a line that looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic, <span class="kw">aes</span>(Age, Survived)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>),
              <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/titanic_age_glm_plot-1.png" width="672" /></p>
<p>It’s hard to tell, but the line is not perfectly linear. Let’s expand the range of the x-axis to prove this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic, <span class="kw">aes</span>(Age, Survived)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>),
              <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">fullrange =</span> <span class="ot">TRUE</span>) +
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="dv">200</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/titanic_age_glm_plot_wide-1.png" width="672" /></p>
<p>No more predictions that a 200 year old has a <span class="math inline">\(-.1\)</span> probability of surviving!</p>
<div id="adding-predictions" class="section level2">
<h2>Adding predictions</h2>
<p>To visualise the predictions from a model, we start by generating an evenly spaced grid of values that covers the region where our data lies. First we use <code>modelr::data_grid()</code> to create a cleaned data frame of potential values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_age &lt;-<span class="st"> </span>titanic %&gt;%
<span class="st">  </span><span class="kw">data_grid</span>(Age)
titanic_age</code></pre></div>
<pre><code>## # A tibble: 88 × 1
##      Age
##    &lt;dbl&gt;
## 1   0.42
## 2   0.67
## 3   0.75
## 4   0.83
## 5   0.92
## 6   1.00
## 7   2.00
## 8   3.00
## 9   4.00
## 10  5.00
## # ... with 78 more rows</code></pre>
<p>Next we could use the <code>add_predictions</code> function to produce the predicted probabilities. <a href="stat002_linear_models.html#generating_predicted_values">This worked very well for linear models</a>; unfortunately it is not perfect for logistic regression. This is because, in truth, logistic regression directly estimates the <a href="https://wiki.lesswrong.com/wiki/Log_odds"><strong>log-odds</strong></a> for the outcome. Instead, we want the plain old predicted probability. To do this, use this custom function to convert from log-odds to predicted probabilties:<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logit2prob &lt;-<span class="st"> </span>function(x){
  <span class="kw">exp</span>(x) /<span class="st"> </span>(<span class="dv">1</span> +<span class="st"> </span><span class="kw">exp</span>(x))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(modelr)

titanic_age &lt;-<span class="st"> </span>titanic_age %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(survive_age) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred))
titanic_age</code></pre></div>
<pre><code>## # A tibble: 88 × 2
##      Age      pred
##    &lt;dbl&gt;     &lt;dbl&gt;
## 1   0.42 0.4846727
## 2   0.67 0.4839882
## 3   0.75 0.4837691
## 4   0.83 0.4835501
## 5   0.92 0.4833037
## 6   1.00 0.4830847
## 7   2.00 0.4803475
## 8   3.00 0.4776115
## 9   4.00 0.4748768
## 10  5.00 0.4721436
## # ... with 78 more rows</code></pre>
<p>With this information, we can now plot the logistic regression line using the estimated model (and not just <code>ggplot2::geom_smooth</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic_age, <span class="kw">aes</span>(Age, pred)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Relationship Between Age and Surviving the Titanic&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Probability of Survival&quot;</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/plot_pred-1.png" width="672" /></p>
</div>
<div id="multiple-predictors" class="section level2">
<h2>Multiple predictors</h2>
<p>But as the old principle of the sea goes, <a href="https://en.wikipedia.org/wiki/Women_and_children_first">“women and children first”</a>. What if age isn’t the only factor effecting survival? Fortunately logistic regression handles multiple predictors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">survive_age_woman &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~<span class="st"> </span>Age +<span class="st"> </span>Sex, <span class="dt">data =</span> titanic,
                         <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(survive_age_woman)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Survived ~ Age + Sex, family = binomial, data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7405  -0.6885  -0.6558   0.7533   1.8989  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.277273   0.230169   5.549 2.87e-08 ***
## Age         -0.005426   0.006310  -0.860     0.39    
## Sexmale     -2.465920   0.185384 -13.302  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 964.52  on 713  degrees of freedom
## Residual deviance: 749.96  on 711  degrees of freedom
##   (177 observations deleted due to missingness)
## AIC: 755.96
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The coefficients essentially tell us the relationship between each individual predictor and the response, <strong>independent of other predictors</strong>. So this model tells us the relationship between age and survival, after controlling for the effects of gender. Likewise, it also tells us the relationship between gender and survival, after controlling for the effects of age. To get a better visualization of this, let’s use <code>data_grid()</code> and <code>add_predictions()</code> again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_age_sex &lt;-<span class="st"> </span>titanic %&gt;%
<span class="st">  </span><span class="kw">data_grid</span>(Age, Sex) %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(survive_age_woman) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred))
titanic_age_sex</code></pre></div>
<pre><code>## # A tibble: 176 × 3
##      Age    Sex      pred
##    &lt;dbl&gt;  &lt;chr&gt;     &lt;dbl&gt;
## 1   0.42 female 0.7815965
## 2   0.42   male 0.2330934
## 3   0.67 female 0.7813649
## 4   0.67   male 0.2328510
## 5   0.75 female 0.7812907
## 6   0.75   male 0.2327735
## 7   0.83 female 0.7812165
## 8   0.83   male 0.2326960
## 9   0.92 female 0.7811330
## 10  0.92   male 0.2326088
## # ... with 166 more rows</code></pre>
<p>With these predicted probabilities, we can now plot the separate effects of age and gender:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic_age_sex, <span class="kw">aes</span>(Age, pred, <span class="dt">color =</span> Sex)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Probability of Surviving the Titanic&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Probability of Survival&quot;</span>,
       <span class="dt">color =</span> <span class="st">&quot;Sex&quot;</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/survive_age_woman_plot-1.png" width="672" /></p>
<p>This graph illustrates a key fact about surviving the sinking of the Titanic - age was not really a dominant factor. Instead, one’s gender was much more important. Females survived at much higher rates than males, regardless of age.</p>
</div>
<div id="quadratic-terms" class="section level2">
<h2>Quadratic terms</h2>
<p>Logistic regression, like linear regression, assumes each predictor has an independent and linear relationship with the response. That is, it assumes the relationship takes the form <span class="math inline">\(y = \beta_0 + \beta_{1}x\)</span> looks something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_line &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">1000</span>),
                   <span class="dt">y =</span> x *<span class="st"> </span><span class="dv">1</span>)

<span class="kw">ggplot</span>(sim_line, <span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/straight_line-1.png" width="672" /></p>
<p>But from algebra we know that variables can have non-linear relationships. Perhaps instead the relationship is parabolic like <span class="math inline">\(y = \beta_0 + \beta_{1}x + \beta_{2}x^2\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_line &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, -<span class="dv">1</span>, <span class="dv">1</span>),
                   <span class="dt">y =</span> x^<span class="dv">2</span> +<span class="st"> </span>x)

<span class="kw">ggplot</span>(sim_line, <span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/parabola-1.png" width="672" /></p>
<p>Or a more general quadratic equation <span class="math inline">\(y = \beta_0 + \beta_{1}x + \beta_{2}x^2 + \beta_{3}x^3\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_line &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, -<span class="dv">1</span>, <span class="dv">1</span>),
                   <span class="dt">y =</span> x^<span class="dv">3</span> +<span class="st"> </span>x^<span class="dv">2</span> +<span class="st"> </span>x)

<span class="kw">ggplot</span>(sim_line, <span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/quadratic-1.png" width="672" /></p>
<p>These can be accounted for in a logistic regression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">survive_age_square &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~<span class="st"> </span>Age +<span class="st"> </span><span class="kw">I</span>(Age^<span class="dv">2</span>), <span class="dt">data =</span> titanic,
                          <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(survive_age_square)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Survived ~ Age + I(Age^2), family = binomial, data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.2777  -1.0144  -0.9516   1.3421   1.4278  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  0.2688449  0.2722529   0.987   0.3234  
## Age         -0.0365193  0.0172749  -2.114   0.0345 *
## I(Age^2)     0.0003965  0.0002538   1.562   0.1183  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 964.52  on 713  degrees of freedom
## Residual deviance: 957.81  on 711  degrees of freedom
##   (177 observations deleted due to missingness)
## AIC: 963.81
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_age %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(survive_age) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred)) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Age, pred)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Relationship Between Age and Surviving the Titanic&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Probability of Survival&quot;</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Here the parabolic term (<span class="math inline">\(\text{age}^2\)</span>) is not actually meaningful. In other contexts it may be so.</p>
</div>
<div id="interactive-terms" class="section level2">
<h2>Interactive terms</h2>
<p>Another assumption of linear and logistic regression is that the relationships between predictors and responses are independent from one another. So for the age and gender example, we assume our function <span class="math inline">\(f\)</span> looks something like:<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<p><span class="math display">\[f = \beta_{0} + \beta_{1}\text{age} + \beta_{2}\text{gender}\]</span></p>
<p>However once again, that is an assumption. What if the relationship between age and the probability of survival is actually dependent on whether or not the individual is a female? This possibility would take the functional form:</p>
<p><span class="math display">\[f = \beta_{0} + \beta_{1}\text{age} + \beta_{2}\text{gender} + \beta_{3}(\text{age} \times \text{gender})\]</span></p>
<p>This is considered an <strong>interaction</strong> between age and gender. To estimate this in R, we simply specify <code>Age * Sex</code> in our formula for the <code>glm()</code> function:<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">survive_age_woman_x &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~<span class="st"> </span>Age *<span class="st"> </span>Sex, <span class="dt">data =</span> titanic,
                           <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(survive_age_woman_x)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Survived ~ Age * Sex, family = binomial, data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9401  -0.7136  -0.5883   0.7626   2.2455  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  0.59380    0.31032   1.913  0.05569 . 
## Age          0.01970    0.01057   1.863  0.06240 . 
## Sexmale     -1.31775    0.40842  -3.226  0.00125 **
## Age:Sexmale -0.04112    0.01355  -3.034  0.00241 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 964.52  on 713  degrees of freedom
## Residual deviance: 740.40  on 710  degrees of freedom
##   (177 observations deleted due to missingness)
## AIC: 748.4
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>As before, let’s estimate predicted probabilities and plot the interactive effects of age and gender.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_age_sex_x &lt;-<span class="st"> </span>titanic %&gt;%
<span class="st">  </span><span class="kw">data_grid</span>(Age, Sex) %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(survive_age_woman_x) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred))
titanic_age_sex_x</code></pre></div>
<pre><code>## # A tibble: 176 × 3
##      Age    Sex      pred
##    &lt;dbl&gt;  &lt;chr&gt;     &lt;dbl&gt;
## 1   0.42 female 0.6461311
## 2   0.42   male 0.3245488
## 3   0.67 female 0.6472564
## 4   0.67   male 0.3233762
## 5   0.75 female 0.6476162
## 6   0.75   male 0.3230014
## 7   0.83 female 0.6479758
## 8   0.83   male 0.3226269
## 9   0.92 female 0.6483802
## 10  0.92   male 0.3222058
## # ... with 166 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(titanic_age_sex_x, <span class="kw">aes</span>(Age, pred, <span class="dt">color =</span> Sex)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Probability of Surviving the Titanic&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Probability of Survival&quot;</span>,
       <span class="dt">color =</span> <span class="st">&quot;Sex&quot;</span>)</code></pre></div>
<p><img src="stat003_logistic_regression_files/figure-html/age_woman_plot-1.png" width="672" /></p>
<p>And now our minds are blown once again! For women, as age increases the probability of survival also increases. However for men, we see the opposite relationship: as age increases the probability of survival <strong>decreases</strong>. Again, the basic principle of saving women and children first can be seen empirically in the estimated probability of survival. Male children are treated similarly to female children, and their survival is prioritized. Even still, the odds of survival are always worse for men than women, but the regression function clearly shows a difference from our previous results.</p>
<p>You may think then that it makes sense to throw in interaction terms (and quadratic terms) willy-nilly to all your regression models since we never know for sure if the relationship is strictly linear and independent. You could do that, but once you start adding more predictors (3, 4, 5, etc.) that will get very difficult to keep track of (five-way interactions are extremely difficult to interpret - even three-way get to be problematic). The best advice is to use theory and your domain knowledge as your guide. Do you have a reason to believe the relationship should be interactive? If so, test for it. If not, don’t.</p>
</div>
</div>
<div id="evaluating-model-accuracy" class="section level1">
<h1>Evaluating model accuracy</h1>
<div id="accuracy-of-predictions" class="section level2">
<h2>Accuracy of predictions</h2>
<p>How do we know if a logistic regression model is good or bad? One evalation criteria simply asks: how accurate are the predictions? For instance, how often did our basic model just using age perform? First we need to get the predicted probabilities for each individual in the original dataset, convert the probability to a prediction (I use a <span class="math inline">\(.5\)</span> cut-point), then see what percentage of predictions were the same as the actual survivals?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age_accuracy &lt;-<span class="st"> </span>titanic %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(survive_age) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred),
         <span class="dt">pred =</span> <span class="kw">as.numeric</span>(pred &gt;<span class="st"> </span>.<span class="dv">5</span>))

<span class="kw">mean</span>(age_accuracy$Survived ==<span class="st"> </span>age_accuracy$pred, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 0.5938375</code></pre>
<p><span class="math inline">\(59.4\%\)</span> of the predictions based on age were correct. If we flipped a coin to make our predictions, we’d be right about 50% of the time. So this is a decent improvement. Of course, we also know that <span class="math inline">\(61.6\%\)</span> of passengers died in the sinking, so if we just guessed that every passenger died we’d still be right more often than our predictive model. Maybe this model isn’t so great after all. What about our interactive age and gender model?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x_accuracy &lt;-<span class="st"> </span>titanic %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(survive_age_woman_x) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred),
         <span class="dt">pred =</span> <span class="kw">as.numeric</span>(pred &gt;<span class="st"> </span>.<span class="dv">5</span>))

<span class="kw">mean</span>(x_accuracy$Survived ==<span class="st"> </span>x_accuracy$pred, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 0.780112</code></pre>
<p>This model is much better. Just by knowing an individual’s age and gender, we can predict with 78% whether he/she lives or dies.</p>
</div>
<div id="trainingtest-sets" class="section level2">
<h2>Training/test sets</h2>
<p>One issue with the previous approach is that we are fitting our model to the data, then using the same data to assess the model’s accuracy. This isn’t very appropriate because we will bias our model towards fitting the data that we have. <strong>We may fit our function to create the results we expect or desire, rather than the “true” function</strong>.</p>
<p>Instead, we can split our data into distinct <strong>training</strong> and <strong>test</strong> sets. The training set can be used repeatedly to explore or train different models. Once we have a stable model, we can apply it to the test set of held-out data to determine (unbiasedly) whether the model makes accurate predictions.</p>
<p>Let’s use this workflow instead. We can use <code>resample_partition()</code> from <code>modelr</code> to split <code>titanic</code> into a training and test set (we’ll allocate 70% of observations to the training set and 30% to the test set), reproduce the interactive model using only the training data, then make predictions on the test set and compare them to the actual, known survivals and deaths.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_split &lt;-<span class="st"> </span><span class="kw">resample_partition</span>(titanic, <span class="kw">c</span>(<span class="dt">test =</span> <span class="fl">0.3</span>, <span class="dt">train =</span> <span class="fl">0.7</span>))
<span class="kw">map</span>(titanic_split, dim)</code></pre></div>
<pre><code>## $test
## [1] 267  12
## 
## $train
## [1] 624  12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train_model &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~<span class="st"> </span>Age *<span class="st"> </span>Sex, <span class="dt">data =</span> titanic_split$train,
                   <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(train_model)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Survived ~ Age * Sex, family = binomial, data = titanic_split$train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8765  -0.7044  -0.6275   0.7196   2.0578  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.86628    0.38916   2.226 0.026010 *  
## Age          0.01470    0.01335   1.101 0.270977    
## Sexmale     -1.82445    0.49785  -3.665 0.000248 ***
## Age:Sexmale -0.02759    0.01647  -1.675 0.094019 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 669.07  on 493  degrees of freedom
## Residual deviance: 507.90  on 490  degrees of freedom
##   (130 observations deleted due to missingness)
## AIC: 515.9
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x_test_accuracy &lt;-<span class="st"> </span>titanic_split$test %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>() %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(train_model) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred),
         <span class="dt">pred =</span> <span class="kw">as.numeric</span>(pred &gt;<span class="st"> </span>.<span class="dv">5</span>))

<span class="kw">mean</span>(x_test_accuracy$Survived ==<span class="st"> </span>x_test_accuracy$pred, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 0.7636364</code></pre>
<p>This is reassuring. <span class="math inline">\(76.4\%\)</span> of the test set observations were accurately predicted. Remember, we explicitly set this up so that the model never saw the test observations, and they never factored into our decisionmaking process when we generated the model. This tells us that we did a pretty good job estimating the functional form <span class="math inline">\(f\)</span> for the entire dataset, not just the training set.</p>
</div>
</div>
<div id="exercise-logistic-regression-with-mental_health" class="section level1">
<h1>Exercise: logistic regression with <code>mental_health</code></h1>
<p>Why do some people vote in elections while others do not? Typical explanations focus on a resource model of participation – individuals with greater resources, such as time, money, and civic skills, are more likely to participate in politics. An emerging theory assesses an individual’s mental health and its effect on political participation.<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> Depression increases individuals’ feelings of hopelessness and political efficacy, so depressed individuals will have less desire to participate in politics. More importantly to our resource model of participation, individuals with depression suffer physical ailments such as a lack of energy, headaches, and muscle soreness which drain an individual’s energy and requires time and money to receive treatment. For these reasons, we should expect that individuals with depression are less likely to participate in election than those without symptoms of depression.</p>
<p>Use the <code>mental_health</code> data set in <code>library(rcfss)</code> and logistic regression to predict whether or not an individual voted in the 1996 presidental election.<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rcfss)
mental_health</code></pre></div>
<pre><code>## # A tibble: 1,317 × 5
##    vote96   age  educ female mhealth
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1       1    60    12      0       0
## 2       1    36    12      0       1
## 3       0    21    13      0       7
## 4       0    29    13      0       6
## 5       1    39    18      1       2
## 6       1    41    15      1       1
## 7       1    48    20      0       2
## 8       0    20    12      1       9
## 9       0    27    11      1       9
## 10      0    34     7      1       2
## # ... with 1,307 more rows</code></pre>
<ol style="list-style-type: decimal">
<li><p>Split the data into a training and test set (70/30%).</p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mh_split &lt;-<span class="st"> </span><span class="kw">resample_partition</span>(mental_health, <span class="kw">c</span>(<span class="dt">test =</span> <span class="fl">0.3</span>, <span class="dt">train =</span> <span class="fl">0.7</span>))</code></pre></div>
</p>
<p></details></p></li>
<li><p>Estimate a logistic regression model of voter turnout using the training set and only <code>mhealth</code> as the predictor. Estimate predicted probabilities and plot the logistic regression line using <code>ggplot</code>.</p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model</span>
mh_model &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 ~<span class="st"> </span>mhealth, <span class="dt">data =</span> mh_split$train,
                <span class="dt">family =</span> binomial)
<span class="kw">tidy</span>(mh_model)</code></pre></div>
<pre><code>##          term   estimate  std.error statistic      p.value
## 1 (Intercept)  1.2397632 0.10644410 11.647082 2.374509e-31
## 2     mhealth -0.1881686 0.02657547 -7.080538 1.435963e-12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate predicted probabilities</span>
mh_health &lt;-<span class="st"> </span>mh_split$train %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>() %&gt;%
<span class="st">  </span><span class="kw">data_grid</span>(mhealth) %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(mh_model) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred))
mh_health</code></pre></div>
<pre><code>## # A tibble: 10 × 2
##    mhealth      pred
##      &lt;dbl&gt;     &lt;dbl&gt;
## 1        0 0.7755228
## 2        1 0.7410810
## 3        2 0.7033759
## 4        3 0.6626794
## 5        4 0.6194204
## 6        5 0.5741785
## 7        6 0.5276596
## 8        7 0.4806554
## 9        8 0.4339911
## 10       9 0.3884685</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># graph the line</span>
<span class="kw">ggplot</span>(mh_health, <span class="kw">aes</span>(mhealth, pred)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Relationship Between Mental Health and Voter Turnout&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Probability of Voting&quot;</span>) +
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<img src="stat003_logistic_regression_files/figure-html/mh-model-1.png" width="672" />
</p>
<p></details></p></li>
<li><p>Calculate the accuracy rate of the model using the test set.</p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mh_model_accuracy &lt;-<span class="st"> </span>mh_split$test %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>() %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(mh_model) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred),
         <span class="dt">pred =</span> <span class="kw">as.numeric</span>(pred &gt;<span class="st"> </span>.<span class="dv">5</span>))

(mh_model_err &lt;-<span class="st"> </span><span class="kw">mean</span>(mh_model_accuracy$vote96 ==<span class="st"> </span>mh_model_accuracy$pred, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## [1] 0.6708861</code></pre>
</p>
<p></details></p></li>
<li><p>Estimate a second logistic regression model of voter turnout using the training set and all the predictors. Calculate it’s accuracy rate using the test set, and compare it to the original model. Which is better?</p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model</span>
mh_model_all &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 ~<span class="st"> </span>., <span class="dt">data =</span> mh_split$train,
                <span class="dt">family =</span> binomial)
<span class="kw">tidy</span>(mh_model_all)</code></pre></div>
<pre><code>##          term    estimate   std.error  statistic      p.value
## 1 (Intercept) -4.44016721 0.576674635 -7.6996055 1.364869e-14
## 2         age  0.04403047 0.005408861  8.1404333 3.938659e-16
## 3        educ  0.27216937 0.032938863  8.2628646 1.422176e-16
## 4      female  0.02640803 0.155390678  0.1699461 8.650526e-01
## 5     mhealth -0.12308493 0.028897636 -4.2593424 2.050292e-05</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate accuracy rate on test set</span>
mh_model_all_accuracy &lt;-<span class="st"> </span>mh_split$test %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>() %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(mh_model_all) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">logit2prob</span>(pred),
         <span class="dt">pred =</span> <span class="kw">as.numeric</span>(pred &gt;<span class="st"> </span>.<span class="dv">5</span>))

(mh_model_all_err &lt;-<span class="st"> </span><span class="kw">mean</span>(mh_model_all_accuracy$vote96 ==<span class="st"> </span>mh_model_all_accuracy$pred, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## [1] 0.6987342</code></pre>
The model with all predictors has a 2.78% higher accuracy rate than predictions based only on mental health.
</p>
<p></details></p></li>
</ol>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>()</code></pre></div>
<pre><code>##  setting  value                       
##  version  R version 3.3.2 (2016-10-31)
##  system   x86_64, darwin13.4.0        
##  ui       RStudio (1.0.136)           
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-03-06                  
## 
##  package        * version    date       source                        
##  assertthat       0.1        2013-12-06 CRAN (R 3.3.0)                
##  backports        1.0.5      2017-01-18 CRAN (R 3.3.2)                
##  base64enc        0.1-3      2015-07-28 CRAN (R 3.3.0)                
##  bigrquery      * 0.3.0      2016-06-28 CRAN (R 3.3.0)                
##  bitops           1.0-6      2013-08-17 CRAN (R 3.3.0)                
##  boot           * 1.3-18     2016-02-23 CRAN (R 3.3.2)                
##  broom          * 0.4.2      2017-02-13 CRAN (R 3.3.2)                
##  car              2.1-4      2016-12-02 CRAN (R 3.3.2)                
##  caret          * 6.0-73     2016-11-10 CRAN (R 3.3.2)                
##  class            7.3-14     2015-08-30 CRAN (R 3.3.2)                
##  codetools        0.2-15     2016-10-05 CRAN (R 3.3.2)                
##  colorspace       1.3-2      2016-12-14 CRAN (R 3.3.2)                
##  config           0.2        2016-08-02 CRAN (R 3.3.0)                
##  curl           * 2.3        2016-11-24 CRAN (R 3.3.2)                
##  DBI              0.5-1      2016-09-10 CRAN (R 3.3.0)                
##  devtools         1.12.0     2016-06-24 CRAN (R 3.3.0)                
##  digest           0.6.12     2017-01-27 CRAN (R 3.3.2)                
##  dplyr          * 0.5.0      2016-06-24 CRAN (R 3.3.0)                
##  e1071          * 1.6-8      2017-02-02 CRAN (R 3.3.2)                
##  evaluate         0.10       2016-10-11 CRAN (R 3.3.0)                
##  FNN            * 1.1        2013-07-31 CRAN (R 3.3.0)                
##  forcats        * 0.2.0      2017-01-23 CRAN (R 3.3.2)                
##  foreach        * 1.4.3      2015-10-13 CRAN (R 3.3.0)                
##  foreign          0.8-67     2016-09-13 CRAN (R 3.3.2)                
##  gam            * 1.14       2016-09-10 CRAN (R 3.3.0)                
##  gapminder      * 0.2.0      2015-12-31 CRAN (R 3.3.0)                
##  gbm            * 2.1.1      2015-03-11 CRAN (R 3.3.0)                
##  geosphere        1.5-5      2016-06-15 CRAN (R 3.3.0)                
##  ggdendro       * 0.1-20     2017-02-27 local                         
##  ggmap          * 2.7        2016-12-07 Github (dkahle/ggmap@c6b7579) 
##  ggplot2        * 2.2.1      2016-12-30 CRAN (R 3.3.2)                
##  ggrepel        * 0.6.5      2016-11-24 CRAN (R 3.3.2)                
##  ggstance       * 0.3        2016-11-16 CRAN (R 3.3.2)                
##  gridExtra      * 2.2.1      2016-02-29 cran (@2.2.1)                 
##  gtable           0.2.0      2016-02-26 CRAN (R 3.3.0)                
##  haven          * 1.0.0      2016-09-23 cran (@1.0.0)                 
##  here           * 0.0-6      2017-02-04 Github (krlmlr/here@007bfd9)  
##  hexbin         * 1.27.1     2015-08-19 CRAN (R 3.3.0)                
##  highr            0.6        2016-05-09 CRAN (R 3.3.0)                
##  hms              0.3        2016-11-22 CRAN (R 3.3.2)                
##  htmltools        0.3.5      2016-03-21 CRAN (R 3.3.0)                
##  htmlwidgets      0.8        2016-11-09 CRAN (R 3.3.1)                
##  httpuv           1.3.3      2015-08-04 CRAN (R 3.3.0)                
##  httr           * 1.2.1      2016-07-03 CRAN (R 3.3.0)                
##  igraph           1.0.1      2015-06-26 CRAN (R 3.3.0)                
##  ISLR           * 1.0        2013-06-11 CRAN (R 3.3.0)                
##  iterators        1.0.8      2015-10-13 CRAN (R 3.3.0)                
##  janeaustenr      0.1.4      2016-10-26 CRAN (R 3.3.0)                
##  jpeg             0.1-8      2014-01-23 cran (@0.1-8)                 
##  jsonlite       * 1.2        2016-12-31 CRAN (R 3.3.2)                
##  kknn           * 1.3.1      2016-03-26 CRAN (R 3.3.0)                
##  knitr          * 1.15.1     2016-11-22 cran (@1.15.1)                
##  labeling         0.3        2014-08-23 CRAN (R 3.3.0)                
##  lattice        * 0.20-34    2016-09-06 CRAN (R 3.3.2)                
##  lazyeval         0.2.0      2016-06-12 CRAN (R 3.3.0)                
##  lme4             1.1-12     2016-04-16 cran (@1.1-12)                
##  lubridate      * 1.6.0      2016-09-13 CRAN (R 3.3.0)                
##  lvplot         * 0.2.0.9000 2017-01-06 Github (hadley/lvplot@8ce61c7)
##  magrittr         1.5        2014-11-22 CRAN (R 3.3.0)                
##  mapproj          1.2-4      2015-08-03 CRAN (R 3.3.0)                
##  maps           * 3.1.1      2016-07-27 cran (@3.1.1)                 
##  MASS             7.3-45     2016-04-21 CRAN (R 3.3.2)                
##  Matrix           1.2-8      2017-01-20 CRAN (R 3.3.2)                
##  MatrixModels   * 0.4-1      2015-08-22 CRAN (R 3.3.0)                
##  memoise          1.0.0      2016-01-29 CRAN (R 3.3.0)                
##  mgcv             1.8-17     2017-02-08 CRAN (R 3.3.2)                
##  microbenchmark * 1.4-2.1    2015-11-25 CRAN (R 3.3.0)                
##  mime             0.5        2016-07-07 CRAN (R 3.3.0)                
##  minqa            1.2.4      2014-10-09 cran (@1.2.4)                 
##  mnormt           1.5-5      2016-10-15 CRAN (R 3.3.0)                
##  ModelMetrics     1.1.0      2016-08-26 CRAN (R 3.3.0)                
##  modelr         * 0.1.0      2016-08-31 CRAN (R 3.3.0)                
##  modeltools       0.2-21     2013-09-02 CRAN (R 3.3.0)                
##  munsell          0.4.3      2016-02-13 CRAN (R 3.3.0)                
##  nlme             3.1-131    2017-02-06 CRAN (R 3.3.2)                
##  nloptr           1.0.4      2014-08-04 cran (@1.0.4)                 
##  NLP              0.1-9      2016-02-18 CRAN (R 3.3.0)                
##  nnet           * 7.3-12     2016-02-02 CRAN (R 3.3.2)                
##  nycflights13   * 0.2.2      2017-01-27 CRAN (R 3.3.2)                
##  pbkrtest         0.4-6      2016-01-27 CRAN (R 3.3.0)                
##  plyr             1.8.4      2016-06-08 CRAN (R 3.3.0)                
##  png              0.1-7      2013-12-03 cran (@0.1-7)                 
##  pROC           * 1.9.1      2017-02-05 CRAN (R 3.3.2)                
##  profvis        * 0.3.3      2017-01-14 CRAN (R 3.3.2)                
##  proto            1.0.0      2016-10-29 CRAN (R 3.3.0)                
##  psych            1.6.12     2017-01-08 CRAN (R 3.3.2)                
##  purrr          * 0.2.2      2016-06-18 CRAN (R 3.3.0)                
##  quantreg       * 5.29       2016-09-04 CRAN (R 3.3.0)                
##  R6               2.2.0      2016-10-05 CRAN (R 3.3.0)                
##  randomForest   * 4.6-12     2015-10-07 CRAN (R 3.3.0)                
##  rappdirs         0.3.1      2016-03-28 CRAN (R 3.3.0)                
##  rcfss          * 0.1.4      2017-02-28 local                         
##  Rcpp             0.12.9     2017-01-14 CRAN (R 3.3.2)                
##  readr          * 1.0.0      2016-08-03 CRAN (R 3.3.0)                
##  readxl         * 0.1.1      2016-03-28 CRAN (R 3.3.0)                
##  rebird         * 0.3.0      2016-03-23 CRAN (R 3.3.0)                
##  reshape2         1.4.2      2016-10-22 CRAN (R 3.3.0)                
##  RgoogleMaps      1.4.1      2016-09-18 cran (@1.4.1)                 
##  rjson            0.2.15     2014-11-03 cran (@0.2.15)                
##  rmarkdown        1.3        2016-12-21 CRAN (R 3.3.2)                
##  rprojroot        1.2        2017-01-16 CRAN (R 3.3.2)                
##  rsconnect        0.7        2016-12-21 CRAN (R 3.3.2)                
##  RSQLite        * 1.1-2      2017-01-08 CRAN (R 3.3.2)                
##  rstudioapi       0.6        2016-06-27 CRAN (R 3.3.0)                
##  rvest          * 0.3.2      2016-06-17 CRAN (R 3.3.0)                
##  scales         * 0.4.1      2016-11-09 CRAN (R 3.3.1)                
##  shiny          * 1.0.0      2017-01-12 CRAN (R 3.3.2)                
##  slam             0.1-40     2016-12-01 CRAN (R 3.3.2)                
##  SnowballC        0.5.1      2014-08-09 cran (@0.5.1)                 
##  sp               1.2-4      2016-12-22 CRAN (R 3.3.2)                
##  sparklyr       * 0.5.2      2017-02-16 CRAN (R 3.3.2)                
##  SparseM        * 1.74       2016-11-10 CRAN (R 3.3.2)                
##  stringi          1.1.2      2016-10-01 CRAN (R 3.3.0)                
##  stringr        * 1.1.0      2016-08-19 cran (@1.1.0)                 
##  survival       * 2.40-1     2016-10-30 CRAN (R 3.3.0)                
##  tibble         * 1.2        2016-08-26 cran (@1.2)                   
##  tidyr          * 0.6.1      2017-01-10 CRAN (R 3.3.2)                
##  tidytext       * 0.1.2      2016-10-28 CRAN (R 3.3.0)                
##  tidyverse      * 1.1.1      2017-01-27 CRAN (R 3.3.2)                
##  titanic        * 0.1.0      2015-08-31 CRAN (R 3.3.0)                
##  tm               0.6-2      2015-07-03 CRAN (R 3.3.0)                
##  tokenizers       0.1.4      2016-08-29 CRAN (R 3.3.0)                
##  topicmodels    * 0.2-4      2016-05-23 CRAN (R 3.3.0)                
##  tree           * 1.0-37     2016-01-21 CRAN (R 3.3.0)                
##  withr            1.0.2      2016-06-20 CRAN (R 3.3.0)                
##  XML            * 3.98-1.5   2016-11-10 CRAN (R 3.3.2)                
##  xml2           * 1.1.1      2017-01-24 CRAN (R 3.3.2)                
##  xtable           1.8-2      2016-02-05 CRAN (R 3.3.0)                
##  yaml             2.1.14     2016-11-12 cran (@2.1.14)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>General at least as applied to the Titanic. I’d like to think technology has advanced some since the early 20th century that the same patterns do not apply today. <a href="https://en.wikipedia.org/wiki/Costa_Concordia_disaster">Not that sinking ships have gone away.</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>The threshold can be adjusted depending on how conservative or risky of a prediction you wish to make.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Alternatively, we can use <code>broom::augment</code> to add predicted probabilities for the original dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)

<span class="kw">augment</span>(survive_age, <span class="dt">newdata =</span> titanic_age, <span class="dt">type.predict =</span> <span class="st">&quot;response&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>()</code></pre></div>
<pre><code>## # A tibble: 88 × 4
##      Age      pred   .fitted    .se.fit
##    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1   0.42 0.4846727 0.4846727 0.04285304
## 2   0.67 0.4839882 0.4839882 0.04255168
## 3   0.75 0.4837691 0.4837691 0.04245533
## 4   0.83 0.4835501 0.4835501 0.04235903
## 5   0.92 0.4833037 0.4833037 0.04225074
## 6   1.00 0.4830847 0.4830847 0.04215452
## 7   2.00 0.4803475 0.4803475 0.04095580
## 8   3.00 0.4776115 0.4776115 0.03976503
## 9   4.00 0.4748768 0.4748768 0.03858327
## 10  5.00 0.4721436 0.4721436 0.03741165
## # ... with 78 more rows</code></pre>
<ul>
<li><code>newdata = titanic</code> - produces a data frame containing all the original variables + the predicted probability for the observation</li>
<li><code>type.predict = &quot;response&quot;</code> - ensures we get the predicted probabilities, not the logged version</li>
</ul>
<a href="#fnref3">↩</a></li>
<li id="fn4"><p>In mathematical truth, it looks more like: <span class="math display">\[P(\text{survival} = \text{Yes} | \text{age}, \text{gender}) = \frac{1}{1 + e^{-(\beta_{0} + \beta_{1}\text{age} + \beta_{2}\text{gender})}}\]</span><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>R automatically includes constituent terms, so this turns into <code>Age + Sex + Age * Sex</code>. <a href="https://pan-oxfordjournals-org.proxy.uchicago.edu/content/14/1/63.full.pdf+html">Generally you always want to include constituent terms in a regression model with an interaction.</a><a href="#fnref5">↩</a></p></li>
<li id="fn6"><p><a href="http://onlinelibrary.wiley.com.proxy.uchicago.edu/doi/10.1111/ssqu.12173/abstract">Ojeda, C. (2015). Depression and political participation. <em>Social Science Quarterly</em>, 96(5), 1226-1243.</a><a href="#fnref6">↩</a></p></li>
<li id="fn7"><p>Update <code>rcfss</code> using <code>devtools::install_github(&quot;uc-cfss/rcfss&quot;)</code> if you cannot access the data set.<a href="#fnref7">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
