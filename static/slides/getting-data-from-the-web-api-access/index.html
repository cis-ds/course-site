<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Getting data from the web: API access</title>
    <meta charset="utf-8" />
    <meta name="author" content="INFO 5940   Cornell University" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Getting data from the web: API access
]
.author[
### INFO 5940 <br /> Cornell University
]

---






class: inverse, middle

# Methods for obtaining data online

---

## Methods for obtaining data online

* Click and download
* Install and play
* API query
* Scraping

---

## Click and download

* `read.csv` or `readr::read_csv`
* `downloader` package or `curl`

---

## Application programming interface (API)

- Representational State Transfer (REST)
- Uniform Resource Location (URL)
- HTTP methods
    - GET
    - POST

---

## Application programming interface (API)

&lt;img src="/img/wikipedia.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## RESTful queries

1. Submit request to server via URL
1. Return result in a structured format
1. Parse results into a local format

---

## Install and play packages

* Packages with R functions written for existing APIs
* Useful because
    * Reproducible
    * Up-to-date (ideally)
    * Ease of access

---

class: inverse, middle

# Using APIs with existing R packages

---

## `manifestoR`

* Collects and organizes political party manifestos from around the world
* Over 1000 parties from 1945 until today in over 50 countries on five continents
* [`manifestoR`](https://github.com/ManifestoProject/manifestoR)

---

## API authentication

* Key/token
* Obtain key
* Store in `.Rprofile`


```r
# in .Rprofile
options(this_is_my_key = "XXXX")

# later, in the R script:
key &lt;- getOption("this_is_my_key")
```

--

* `usethis::edit_r_profile()`
* Read the documentation - different packages have different storage methods

---

## Load library and set API key


```r
library(manifestoR)

# retrieve API key stored in .Rprofile
mp_setapikey(key = getOption("manifesto_key"))
```

---

## Retrieve the database


```r
(mpds &lt;- mp_maindataset())
```

```
## Connecting to Manifesto Project DB API... 
## Connecting to Manifesto Project DB API... corpus version: 2021-1
```

```
## # A tibble: 4,739 × 174
##    country countryname oecdmember eumember edate        date party partyname    
##      &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        
##  1      11 Sweden               0        0 1944-09-17 194409 11220 Communist Pa…
##  2      11 Sweden               0        0 1944-09-17 194409 11320 Social Democ…
##  3      11 Sweden               0        0 1944-09-17 194409 11420 People’s Par…
##  4      11 Sweden               0        0 1944-09-17 194409 11620 Right Party  
##  5      11 Sweden               0        0 1944-09-17 194409 11810 Agrarian Par…
##  6      11 Sweden               0        0 1948-09-19 194809 11220 Communist Pa…
##  7      11 Sweden               0        0 1948-09-19 194809 11320 Social Democ…
##  8      11 Sweden               0        0 1948-09-19 194809 11420 People’s Par…
##  9      11 Sweden               0        0 1948-09-19 194809 11620 Right Party  
## 10      11 Sweden               0        0 1948-09-19 194809 11810 Agrarian Par…
## # … with 4,729 more rows, and 166 more variables: partyabbrev &lt;chr&gt;,
## #   parfam &lt;dbl&gt;, coderid &lt;dbl&gt;, manual &lt;dbl&gt;, coderyear &lt;dbl&gt;,
## #   testresult &lt;dbl&gt;, testeditsim &lt;dbl&gt;, pervote &lt;dbl&gt;, voteest &lt;dbl&gt;,
## #   presvote &lt;dbl&gt;, absseat &lt;dbl&gt;, totseats &lt;dbl&gt;, progtype &lt;dbl&gt;,
## #   datasetorigin &lt;dbl&gt;, corpusversion &lt;chr&gt;, total &lt;dbl&gt;, peruncod &lt;dbl&gt;,
## #   per101 &lt;dbl&gt;, per102 &lt;dbl&gt;, per103 &lt;dbl&gt;, per104 &lt;dbl&gt;, per105 &lt;dbl&gt;,
## #   per106 &lt;dbl&gt;, per107 &lt;dbl&gt;, per108 &lt;dbl&gt;, per109 &lt;dbl&gt;, per110 &lt;dbl&gt;, …
```

---

&lt;img src="index_files/figure-html/manifesto-dist-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Download manifestos



&lt;img src="index_files/figure-html/manifestor-corpus-wordcloud-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Census data with `tidycensus`

* API to access data from US Census Bureau
    * Decennial census
    * American Community Survey
* Returns tidy data frames with (optional) `sf` geometry
* Search for variables with `load_variables()`

---

## Store API key


```r
library(tidycensus)
```

```r
census_api_key("YOUR API KEY GOES HERE")
```

---

## Obtain data


```r
usa_inc &lt;- get_acs(
  geography = "state",
  variables = c(medincome = "B19013_001"),
  year = 2020
)
usa_inc
```

```
## # A tibble: 52 × 5
##    GEOID NAME                 variable  estimate   moe
##    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
##  1 01    Alabama              medincome    52035   377
##  2 02    Alaska               medincome    77790  1134
##  3 04    Arizona              medincome    61529   286
##  4 05    Arkansas             medincome    49475   431
##  5 06    California           medincome    78672   270
##  6 08    Colorado             medincome    75231   379
##  7 09    Connecticut          medincome    79855   587
##  8 10    Delaware             medincome    69110  1112
##  9 11    District of Columbia medincome    90842  1580
## 10 12    Florida              medincome    57703   269
## # … with 42 more rows
```

---

## Visualize data

&lt;img src="index_files/figure-html/income-usa-plot-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle

# Writing an API function

---

## Writing an API function

* No package for API
* Write your own function!
* [Open Movie Database](http://www.omdbapi.com/)

---

## Expected elements

1. Authentication Key/Token
1. Base URL
1. Search Parameters
1. Response Format

---

## Determine the shape of an API request

&lt;img src="/img/ombd.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Determine the shape of an API request

```http
http://www.omdbapi.com/?apikey=[apikey]&amp;t=Sharknado&amp;y=2013
```


```
## {
##     "Title": "Sharknado",
##     "Year": "2013",
##     "Rated": "TV-14",
##     "Released": "11 Jul 2013",
##     "Runtime": "86 min",
##     "Genre": "Action, Adventure, Comedy, Horror, Sci-Fi, Thriller",
##     "Director": "Anthony C. Ferrante",
##     "Writer": "Thunder Levin",
##     "Actors": "Ian Ziering, Tara Reid, John Heard, Cassandra Scerbo",
##     "Plot": "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of sharks terrorize the waterlogged populace.",
##     "Language": "English",
##     "Country": "USA",
##     "Awards": "1 win &amp; 2 nominations.",
##     "Poster": "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
##     "Ratings": [
##         {
##             "Source": "Internet Movie Database",
##             "Value": "3.3/10"
##         },
##         {
##             "Source": "Rotten Tomatoes",
##             "Value": "74%"
##         }
##     ],
##     "Metascore": "N/A",
##     "imdbRating": "3.3",
##     "imdbVotes": "47,284",
##     "imdbID": "tt2724064",
##     "Type": "movie",
##     "DVD": "03 Sep 2013",
##     "BoxOffice": "N/A",
##     "Production": "N/A",
##     "Website": "N/A",
##     "Response": "True"
## }
## 
```

---

## `httr::GET()`


```r
sharknado &lt;- GET(url = "http://www.omdbapi.com/?",
    query = list(t = "Sharknado",
                 y = 2013,
                 apikey = getOption("omdb_key"))
)
```

---

## JavaScript Object Notation (JSON)


```r
content(sharknado, type = "text") %&gt;%
  # print the contents in a clear structure
  prettify()
```

```
## {
##     "Title": "Sharknado",
##     "Year": "2013",
##     "Rated": "TV-14",
##     "Released": "11 Jul 2013",
##     "Runtime": "86 min",
##     "Genre": "Action, Adventure, Comedy, Horror, Sci-Fi, Thriller",
##     "Director": "Anthony C. Ferrante",
##     "Writer": "Thunder Levin",
##     "Actors": "Ian Ziering, Tara Reid, John Heard, Cassandra Scerbo",
##     "Plot": "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of sharks terrorize the waterlogged populace.",
##     "Language": "English",
##     "Country": "USA",
##     "Awards": "1 win &amp; 2 nominations.",
##     "Poster": "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
##     "Ratings": [
##         {
##             "Source": "Internet Movie Database",
##             "Value": "3.3/10"
##         },
##         {
##             "Source": "Rotten Tomatoes",
##             "Value": "74%"
##         }
##     ],
##     "Metascore": "N/A",
##     "imdbRating": "3.3",
##     "imdbVotes": "47,284",
##     "imdbID": "tt2724064",
##     "Type": "movie",
##     "DVD": "03 Sep 2013",
##     "BoxOffice": "N/A",
##     "Production": "N/A",
##     "Website": "N/A",
##     "Response": "True"
## }
## 
```

---

## JSON


```r
sharknado_df &lt;- content(sharknado) %&gt;%
  as_tibble()
sharknado_df
```

```
## # A tibble: 2 × 25
##   Title Year  Rated Released Runtime Genre Director Writer Actors Plot  Language
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   
## 1 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## 2 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## # … with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;
```

---

## Additional information from `GET()`


```r
sharknado$url
```


```
## [1] "http://www.omdbapi.com/?t=Sharknado&amp;y=2013&amp;apikey=[apikey]"
```

--


```r
status_code(sharknado)
```

```
## [1] 200
```

---

## HTTP status code

Code | Status
-------|--------|
1xx    | Informational
2xx    | Success
3xx    | Redirection
4xx    | Client error (you did something wrong)
5xx    | Server error (server did something wrong)

&gt; [A more intuitive guide](https://www.flickr.com/photos/girliemac/sets/72157628409467125)

---

## Iteration through a set of movies


```r
omdb_api &lt;- function(title, api_key){
  # send GET request
  response &lt;- GET(url = "http://www.omdbapi.com/?",
    query = list(t = title,
                 apikey = api_key)
  )
  
  # parse response to JSON
  response_df &lt;- content(response) %&gt;%
    as_tibble()
  
  # print a message to track progress
  message(glue::glue("Scraping {title}..."))
  
  return(response_df)
}
```

---

## Iteration through a set of movies


```r
sharknados &lt;- c("Sharknado", "Sharknado 2", "Sharknado 3",
                "Sharknado 4", "Sharknado 5")
```


```r
# modify function to delay by one second
omdb_api_slow &lt;- purrr::slowly(f = omdb_api, rate = rate_delay(1))

# iterate over all the films
sharknados_df &lt;- map_dfr(.x = sharknados, .f = omdb_api_slow, api_key = getOption("omdb_key"))
```

```
## Scraping Sharknado...
```

```
## Scraping Sharknado 2...
```

```
## Scraping Sharknado 3...
```

```
## Scraping Sharknado 4...
```

```
## Scraping Sharknado 5...
```

---

## Iteration through a set of movies


```r
sharknados_df
```

```
## # A tibble: 10 × 25
##    Title         Year  Rated Released Runtime Genre Director Writer Actors Plot 
##    &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;
##  1 Sharknado     2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When…
##  2 Sharknado     2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When…
##  3 Sharknado 2:… 2014  TV-14 30 Jul … 95 min  Acti… Anthony… Thund… Ian Z… Fin …
##  4 Sharknado 2:… 2014  TV-14 30 Jul … 95 min  Acti… Anthony… Thund… Ian Z… Fin …
##  5 Sharknado 3:… 2015  TV-14 22 Jul … 93 min  Acti… Anthony… Thund… Ian Z… A mo…
##  6 Sharknado 3:… 2015  TV-14 22 Jul … 93 min  Acti… Anthony… Thund… Ian Z… A mo…
##  7 Sharknado 4:… 2016  TV-14 31 Jul … 95 min  Acti… Anthony… Thund… Ian Z… Fin,…
##  8 Sharknado 4:… 2016  TV-14 31 Jul … 95 min  Acti… Anthony… Thund… Ian Z… Fin,…
##  9 Sharknado 5:… 2017  TV-14 06 Aug … 93 min  Acti… Anthony… Thund… Ian Z… With…
## 10 Sharknado 5:… 2017  TV-14 06 Aug … 93 min  Acti… Anthony… Thund… Ian Z… With…
## # … with 15 more variables: Language &lt;chr&gt;, Country &lt;chr&gt;, Awards &lt;chr&gt;,
## #   Poster &lt;chr&gt;, Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;,
## #   imdbVotes &lt;chr&gt;, imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;,
## #   Production &lt;chr&gt;, Website &lt;chr&gt;, Response &lt;chr&gt;
```

---

## Messy API responses


```r
content(sharknado) %&gt;%
  as_tibble()
```

```
## # A tibble: 2 × 25
##   Title Year  Rated Released Runtime Genre Director Writer Actors Plot  Language
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   
## 1 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## 2 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## # … with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;
```

---

## Whoops


```
## List of 25
##  $ Title     : chr "Sharknado"
##  $ Year      : chr "2013"
##  $ Rated     : chr "TV-14"
##  $ Released  : chr "11 Jul 2013"
##  $ Runtime   : chr "86 min"
##  $ Genre     : chr "Action, Adventure, Comedy, Horror, Sci-Fi, Thriller"
##  $ Director  : chr "Anthony C. Ferrante"
##  $ Writer    : chr "Thunder Levin"
##  $ Actors    : chr "Ian Ziering, Tara Reid, John Heard, Cassandra Scerbo"
##  $ Plot      : chr "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of s"| __truncated__
##  $ Language  : chr "English"
##  $ Country   : chr "USA"
##  $ Awards    : chr "1 win &amp; 2 nominations."
##  $ Poster    : chr "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzM"| __truncated__
##  $ Ratings   :List of 2
##   ..$ :List of 2
##   .. ..$ Source: chr "Internet Movie Database"
##   .. ..$ Value : chr "3.3/10"
##   ..$ :List of 2
##   .. ..$ Source: chr "Rotten Tomatoes"
##   .. ..$ Value : chr "74%"
##  $ Metascore : chr "N/A"
##  $ imdbRating: chr "3.3"
##  $ imdbVotes : chr "47,284"
##  $ imdbID    : chr "tt2724064"
##  $ Type      : chr "movie"
##  $ DVD       : chr "03 Sep 2013"
##  $ BoxOffice : chr "N/A"
##  $ Production: chr "N/A"
##  $ Website   : chr "N/A"
##  $ Response  : chr "True"
```

---

class: inverse, middle

# Rectangling messy data

---

## Rectangling and `tidyr`

.task[
Art and craft of taking a deeply nested list and taming it into a tidy data set of rows and columns
]

--

* `unnest_longer()` - each row contains multiple observations
* `unnest_wider()` - each row contains a single observation
* `unnest_auto()` - make an educated guess
* `hoist()` - extract a specific element
  
---

## `unnest_wider()` and `hoist()`


```r
str(gh_users, list.len = 3)
```

```
## List of 6
##  $ :List of 30
##   ..$ login              : chr "gaborcsardi"
##   ..$ id                 : int 660288
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/660288?v=3"
##   .. [list output truncated]
##  $ :List of 30
##   ..$ login              : chr "jennybc"
##   ..$ id                 : int 599454
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/599454?v=3"
##   .. [list output truncated]
##  $ :List of 30
##   ..$ login              : chr "jtleek"
##   ..$ id                 : int 1571674
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/1571674?v=3"
##   .. [list output truncated]
##   [list output truncated]
```

---

## `unnest_wider()` and `hoist()`


```r
(users &lt;- tibble(user = gh_users))
```

```
## # A tibble: 6 × 1
##   user             
##   &lt;list&gt;           
## 1 &lt;named list [30]&gt;
## 2 &lt;named list [30]&gt;
## 3 &lt;named list [30]&gt;
## 4 &lt;named list [30]&gt;
## 5 &lt;named list [30]&gt;
## 6 &lt;named list [30]&gt;
```

--


```r
names(users$user[[1]])
```

```
##  [1] "login"               "id"                  "avatar_url"         
##  [4] "gravatar_id"         "url"                 "html_url"           
##  [7] "followers_url"       "following_url"       "gists_url"          
## [10] "starred_url"         "subscriptions_url"   "organizations_url"  
## [13] "repos_url"           "events_url"          "received_events_url"
## [16] "type"                "site_admin"          "name"               
## [19] "company"             "blog"                "location"           
## [22] "email"               "hireable"            "bio"                
## [25] "public_repos"        "public_gists"        "followers"          
## [28] "following"           "created_at"          "updated_at"
```

---

## `unnest_wider()`


```r
users %&gt;%
  unnest_wider(col = user)
```

```
## # A tibble: 6 × 30
##   login     id avatar_url gravatar_id url   html_url followers_url following_url
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;        
## 1 gabo… 6.60e5 https://a… ""          http… https:/… https://api.… https://api.…
## 2 jenn… 5.99e5 https://a… ""          http… https:/… https://api.… https://api.…
## 3 jtle… 1.57e6 https://a… ""          http… https:/… https://api.… https://api.…
## 4 juli… 1.25e7 https://a… ""          http… https:/… https://api.… https://api.…
## 5 leep… 3.51e6 https://a… ""          http… https:/… https://api.… https://api.…
## 6 masa… 8.36e6 https://a… ""          http… https:/… https://api.… https://api.…
## # … with 22 more variables: gists_url &lt;chr&gt;, starred_url &lt;chr&gt;,
## #   subscriptions_url &lt;chr&gt;, organizations_url &lt;chr&gt;, repos_url &lt;chr&gt;,
## #   events_url &lt;chr&gt;, received_events_url &lt;chr&gt;, type &lt;chr&gt;, site_admin &lt;lgl&gt;,
## #   name &lt;chr&gt;, company &lt;chr&gt;, blog &lt;chr&gt;, location &lt;chr&gt;, email &lt;chr&gt;,
## #   hireable &lt;lgl&gt;, bio &lt;chr&gt;, public_repos &lt;int&gt;, public_gists &lt;int&gt;,
## #   followers &lt;int&gt;, following &lt;int&gt;, created_at &lt;chr&gt;, updated_at &lt;chr&gt;
```

---

## `hoist()`


```r
users %&gt;%
  hoist(
    .col = user,
    followers = "followers",
    login = "login",
    url = "html_url"
  )
```

```
## # A tibble: 6 × 4
##   followers login       url                            user             
##       &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                          &lt;list&gt;           
## 1       303 gaborcsardi https://github.com/gaborcsardi &lt;named list [27]&gt;
## 2       780 jennybc     https://github.com/jennybc     &lt;named list [27]&gt;
## 3      3958 jtleek      https://github.com/jtleek      &lt;named list [27]&gt;
## 4       115 juliasilge  https://github.com/juliasilge  &lt;named list [27]&gt;
## 5       213 leeper      https://github.com/leeper      &lt;named list [27]&gt;
## 6        34 masalmon    https://github.com/masalmon    &lt;named list [27]&gt;
```

---

## `gh_repos` and nested list structures


```r
(repos &lt;- tibble(repo = gh_repos))
```

```
## # A tibble: 6 × 1
##   repo       
##   &lt;list&gt;     
## 1 &lt;list [30]&gt;
## 2 &lt;list [30]&gt;
## 3 &lt;list [30]&gt;
## 4 &lt;list [26]&gt;
## 5 &lt;list [30]&gt;
## 6 &lt;list [30]&gt;
```

---

## `unnest_longer()`


```r
repos &lt;- repos %&gt;%
  unnest_longer(col = repo)
repos
```

```
## # A tibble: 176 × 1
##    repo             
##    &lt;list&gt;           
##  1 &lt;named list [68]&gt;
##  2 &lt;named list [68]&gt;
##  3 &lt;named list [68]&gt;
##  4 &lt;named list [68]&gt;
##  5 &lt;named list [68]&gt;
##  6 &lt;named list [68]&gt;
##  7 &lt;named list [68]&gt;
##  8 &lt;named list [68]&gt;
##  9 &lt;named list [68]&gt;
## 10 &lt;named list [68]&gt;
## # … with 166 more rows
```

---

## `unnest_longer()`


```r
repos %&gt;%
  hoist(
    .col = repo,
    login = c("owner", "login"),
    name = "name",
    homepage = "homepage",
    watchers = "watchers_count"
  )
```

```
## # A tibble: 176 × 5
##    login       name        homepage watchers repo             
##    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt; &lt;list&gt;           
##  1 gaborcsardi after        &lt;NA&gt;           5 &lt;named list [65]&gt;
##  2 gaborcsardi argufy       &lt;NA&gt;          19 &lt;named list [65]&gt;
##  3 gaborcsardi ask          &lt;NA&gt;           5 &lt;named list [65]&gt;
##  4 gaborcsardi baseimports  &lt;NA&gt;           0 &lt;named list [65]&gt;
##  5 gaborcsardi citest       &lt;NA&gt;           0 &lt;named list [65]&gt;
##  6 gaborcsardi clisymbols  ""             18 &lt;named list [65]&gt;
##  7 gaborcsardi cmaker       &lt;NA&gt;           0 &lt;named list [65]&gt;
##  8 gaborcsardi cmark        &lt;NA&gt;           0 &lt;named list [65]&gt;
##  9 gaborcsardi conditions   &lt;NA&gt;           0 &lt;named list [65]&gt;
## 10 gaborcsardi crayon       &lt;NA&gt;          52 &lt;named list [65]&gt;
## # … with 166 more rows
```

---



count: false
 

.panel1-gh-repos-auto-auto[

```r
*tibble(repo = gh_repos)
```
]
 
.panel2-gh-repos-auto-auto[

```
## # A tibble: 6 × 1
##   repo       
##   &lt;list&gt;     
## 1 &lt;list [30]&gt;
## 2 &lt;list [30]&gt;
## 3 &lt;list [30]&gt;
## 4 &lt;list [26]&gt;
## 5 &lt;list [30]&gt;
## 6 &lt;list [30]&gt;
```
]

---
count: false
 

.panel1-gh-repos-auto-auto[

```r
tibble(repo = gh_repos) %&gt;%
* unnest_auto(col = repo)
```
]
 
.panel2-gh-repos-auto-auto[

```
## # A tibble: 176 × 1
##    repo             
##    &lt;list&gt;           
##  1 &lt;named list [68]&gt;
##  2 &lt;named list [68]&gt;
##  3 &lt;named list [68]&gt;
##  4 &lt;named list [68]&gt;
##  5 &lt;named list [68]&gt;
##  6 &lt;named list [68]&gt;
##  7 &lt;named list [68]&gt;
##  8 &lt;named list [68]&gt;
##  9 &lt;named list [68]&gt;
## 10 &lt;named list [68]&gt;
## # … with 166 more rows
```
]

---
count: false
 

.panel1-gh-repos-auto-auto[

```r
tibble(repo = gh_repos) %&gt;%
  unnest_auto(col = repo) %&gt;%
* unnest_auto(col = repo)
```
]
 
.panel2-gh-repos-auto-auto[

```
## # A tibble: 176 × 68
##         id name  full_name owner        private html_url description fork  url  
##      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;       &lt;lgl&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;
##  1  6.12e7 after gaborcsa… &lt;named list&gt; FALSE   https:/… Run Code i… FALSE http…
##  2  4.05e7 argu… gaborcsa… &lt;named list&gt; FALSE   https:/… Declarativ… FALSE http…
##  3  3.64e7 ask   gaborcsa… &lt;named list&gt; FALSE   https:/… Friendly C… FALSE http…
##  4  3.49e7 base… gaborcsa… &lt;named list&gt; FALSE   https:/… Do we get … FALSE http…
##  5  6.16e7 cite… gaborcsa… &lt;named list&gt; FALSE   https:/… Test R pac… TRUE  http…
##  6  3.39e7 clis… gaborcsa… &lt;named list&gt; FALSE   https:/… Unicode sy… FALSE http…
##  7  3.72e7 cmak… gaborcsa… &lt;named list&gt; FALSE   https:/… port of cm… TRUE  http…
##  8  6.80e7 cmark gaborcsa… &lt;named list&gt; FALSE   https:/… CommonMark… TRUE  http…
##  9  6.32e7 cond… gaborcsa… &lt;named list&gt; FALSE   https:/… &lt;NA&gt;        TRUE  http…
## 10  2.43e7 cray… gaborcsa… &lt;named list&gt; FALSE   https:/… R package … FALSE http…
## # … with 166 more rows, and 59 more variables: forks_url &lt;chr&gt;, keys_url &lt;chr&gt;,
## #   collaborators_url &lt;chr&gt;, teams_url &lt;chr&gt;, hooks_url &lt;chr&gt;,
## #   issue_events_url &lt;chr&gt;, events_url &lt;chr&gt;, assignees_url &lt;chr&gt;,
## #   branches_url &lt;chr&gt;, tags_url &lt;chr&gt;, blobs_url &lt;chr&gt;, git_tags_url &lt;chr&gt;,
## #   git_refs_url &lt;chr&gt;, trees_url &lt;chr&gt;, statuses_url &lt;chr&gt;,
## #   languages_url &lt;chr&gt;, stargazers_url &lt;chr&gt;, contributors_url &lt;chr&gt;,
## #   subscribers_url &lt;chr&gt;, subscription_url &lt;chr&gt;, commits_url &lt;chr&gt;, …
```
]

&lt;style&gt;
.panel1-gh-repos-auto-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-gh-repos-auto-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-gh-repos-auto-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

## ASOIAF characters


```r
chars &lt;- tibble(char = got_chars)
chars
```

```
## # A tibble: 30 × 1
##    char             
##    &lt;list&gt;           
##  1 &lt;named list [18]&gt;
##  2 &lt;named list [18]&gt;
##  3 &lt;named list [18]&gt;
##  4 &lt;named list [18]&gt;
##  5 &lt;named list [18]&gt;
##  6 &lt;named list [18]&gt;
##  7 &lt;named list [18]&gt;
##  8 &lt;named list [18]&gt;
##  9 &lt;named list [18]&gt;
## 10 &lt;named list [18]&gt;
## # … with 20 more rows
```

---

## ASOIAF characters


```r
chars2 &lt;- chars %&gt;%
  unnest_wider(col = char)
chars2
```

```
## # A tibble: 30 × 18
##    url           id name  gender culture born  died  alive titles aliases father
##    &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt; &lt;list&gt; &lt;list&gt;  &lt;chr&gt; 
##  1 https://w…  1022 Theo… Male   "Ironb… "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  2 https://w…  1052 Tyri… Male   ""      "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  3 https://w…  1074 Vict… Male   "Ironb… "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  4 https://w…  1109 Will  Male   ""      ""    "In … FALSE &lt;chr&gt;  &lt;chr&gt;   ""    
##  5 https://w…  1166 Areo… Male   "Norvo… "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  6 https://w…  1267 Chett Male   ""      "At … "In … FALSE &lt;chr&gt;  &lt;chr&gt;   ""    
##  7 https://w…  1295 Cres… Male   ""      "In … "In … FALSE &lt;chr&gt;  &lt;chr&gt;   ""    
##  8 https://w…   130 Aria… Female "Dorni… "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  9 https://w…  1303 Daen… Female "Valyr… "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
## 10 https://w…  1319 Davo… Male   "Weste… "In … ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
## # … with 20 more rows, and 7 more variables: mother &lt;chr&gt;, spouse &lt;chr&gt;,
## #   allegiances &lt;list&gt;, books &lt;list&gt;, povBooks &lt;list&gt;, tvSeries &lt;list&gt;,
## #   playedBy &lt;list&gt;
```

---

## Nested list objects


```r
chars2 %&gt;%
  select(where(is.list))
```

```
## # A tibble: 30 × 7
##    titles    aliases    allegiances books     povBooks  tvSeries  playedBy 
##    &lt;list&gt;    &lt;list&gt;     &lt;list&gt;      &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1 &lt;chr [3]&gt; &lt;chr [4]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
##  2 &lt;chr [2]&gt; &lt;chr [11]&gt; &lt;chr [1]&gt;   &lt;chr [2]&gt; &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
##  3 &lt;chr [2]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  4 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  5 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
##  6 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  7 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  8 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [4]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  9 &lt;chr [5]&gt; &lt;chr [11]&gt; &lt;chr [1]&gt;   &lt;chr [1]&gt; &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
## 10 &lt;chr [4]&gt; &lt;chr [5]&gt;  &lt;chr [2]&gt;   &lt;chr [1]&gt; &lt;chr [3]&gt; &lt;chr [5]&gt; &lt;chr [1]&gt;
## # … with 20 more rows
```

---

## Choose your own adventure

&lt;img src="https://images-na.ssl-images-amazon.com/images/I/81E88dflPeL.jpg" width="30%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle

# Every appearance per book/season

---



count: false
 
## Every appearance per book/season
.panel1-got-appearances-auto[

```r
*select(
* .data = chars2,
* name, books, tvSeries
*) 
```
]
 
.panel2-got-appearances-auto[

```
## # A tibble: 30 × 3
##    name               books     tvSeries 
##    &lt;chr&gt;              &lt;list&gt;    &lt;list&gt;   
##  1 Theon Greyjoy      &lt;chr [3]&gt; &lt;chr [6]&gt;
##  2 Tyrion Lannister   &lt;chr [2]&gt; &lt;chr [6]&gt;
##  3 Victarion Greyjoy  &lt;chr [3]&gt; &lt;chr [1]&gt;
##  4 Will               &lt;chr [1]&gt; &lt;chr [1]&gt;
##  5 Areo Hotah         &lt;chr [3]&gt; &lt;chr [2]&gt;
##  6 Chett              &lt;chr [2]&gt; &lt;chr [1]&gt;
##  7 Cressen            &lt;chr [2]&gt; &lt;chr [1]&gt;
##  8 Arianne Martell    &lt;chr [4]&gt; &lt;chr [1]&gt;
##  9 Daenerys Targaryen &lt;chr [1]&gt; &lt;chr [6]&gt;
## 10 Davos Seaworth     &lt;chr [1]&gt; &lt;chr [5]&gt;
## # … with 20 more rows
```
]

---
count: false
 
## Every appearance per book/season
.panel1-got-appearances-auto[

```r
select(
  .data = chars2,
  name, books, tvSeries
) %&gt;%
* pivot_longer(
*   cols = c(books, tvSeries),
*   names_to = "media",
*   values_to = "value"
* )
```
]
 
.panel2-got-appearances-auto[

```
## # A tibble: 60 × 3
##    name              media    value    
##    &lt;chr&gt;             &lt;chr&gt;    &lt;list&gt;   
##  1 Theon Greyjoy     books    &lt;chr [3]&gt;
##  2 Theon Greyjoy     tvSeries &lt;chr [6]&gt;
##  3 Tyrion Lannister  books    &lt;chr [2]&gt;
##  4 Tyrion Lannister  tvSeries &lt;chr [6]&gt;
##  5 Victarion Greyjoy books    &lt;chr [3]&gt;
##  6 Victarion Greyjoy tvSeries &lt;chr [1]&gt;
##  7 Will              books    &lt;chr [1]&gt;
##  8 Will              tvSeries &lt;chr [1]&gt;
##  9 Areo Hotah        books    &lt;chr [3]&gt;
## 10 Areo Hotah        tvSeries &lt;chr [2]&gt;
## # … with 50 more rows
```
]

---
count: false
 
## Every appearance per book/season
.panel1-got-appearances-auto[

```r
select(
  .data = chars2,
  name, books, tvSeries
) %&gt;%
  pivot_longer(
    cols = c(books, tvSeries),
    names_to = "media",
    values_to = "value"
  ) %&gt;%
* unnest_longer(col = value)
```
]
 
.panel2-got-appearances-auto[

```
## # A tibble: 180 × 3
##    name             media    value            
##    &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;            
##  1 Theon Greyjoy    books    A Game of Thrones
##  2 Theon Greyjoy    books    A Storm of Swords
##  3 Theon Greyjoy    books    A Feast for Crows
##  4 Theon Greyjoy    tvSeries Season 1         
##  5 Theon Greyjoy    tvSeries Season 2         
##  6 Theon Greyjoy    tvSeries Season 3         
##  7 Theon Greyjoy    tvSeries Season 4         
##  8 Theon Greyjoy    tvSeries Season 5         
##  9 Theon Greyjoy    tvSeries Season 6         
## 10 Tyrion Lannister books    A Feast for Crows
## # … with 170 more rows
```
]

&lt;style&gt;
.panel1-got-appearances-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-got-appearances-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-got-appearances-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

class: inverse, middle

# Match character's title to their name

---



count: false
 
## Match character's title to their name
.panel1-got-title-name-auto[

```r
*select(
* .data = chars2,
* name,
* title = titles
*) 
```
]
 
.panel2-got-title-name-auto[

```
## # A tibble: 30 × 2
##    name               title    
##    &lt;chr&gt;              &lt;list&gt;   
##  1 Theon Greyjoy      &lt;chr [3]&gt;
##  2 Tyrion Lannister   &lt;chr [2]&gt;
##  3 Victarion Greyjoy  &lt;chr [2]&gt;
##  4 Will               &lt;chr [1]&gt;
##  5 Areo Hotah         &lt;chr [1]&gt;
##  6 Chett              &lt;chr [1]&gt;
##  7 Cressen            &lt;chr [1]&gt;
##  8 Arianne Martell    &lt;chr [1]&gt;
##  9 Daenerys Targaryen &lt;chr [5]&gt;
## 10 Davos Seaworth     &lt;chr [4]&gt;
## # … with 20 more rows
```
]

---
count: false
 
## Match character's title to their name
.panel1-got-title-name-auto[

```r
select(
  .data = chars2,
  name,
  title = titles
) %&gt;%
* unnest_longer(col = title)
```
]
 
.panel2-got-title-name-auto[

```
## # A tibble: 60 × 2
##    name              title                                                 
##    &lt;chr&gt;             &lt;chr&gt;                                                 
##  1 Theon Greyjoy     "Prince of Winterfell"                                
##  2 Theon Greyjoy     "Captain of Sea Bitch"                                
##  3 Theon Greyjoy     "Lord of the Iron Islands (by law of the green lands)"
##  4 Tyrion Lannister  "Acting Hand of the King (former)"                    
##  5 Tyrion Lannister  "Master of Coin (former)"                             
##  6 Victarion Greyjoy "Lord Captain of the Iron Fleet"                      
##  7 Victarion Greyjoy "Master of the Iron Victory"                          
##  8 Will              ""                                                    
##  9 Areo Hotah        "Captain of the Guard at Sunspear"                    
## 10 Chett             ""                                                    
## # … with 50 more rows
```
]

&lt;style&gt;
.panel1-got-title-name-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-got-title-name-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-got-title-name-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

# May the force be with you

&lt;img src="https://media.giphy.com/media/C0ZArORmrDQCRTIFnQ/giphy.gif" width="80%" style="display: block; margin: auto;" /&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "magula",
"highlightLines": true,
"highlightLanguage": "r",
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
